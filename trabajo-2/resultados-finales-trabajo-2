> hist(df[,2])
> shapiro.test(df[,2])

	Shapiro-Wilk normality test

data:  df[, 2]
W = 0.9971, p-value = 0.9729

> melted_cormat %>% filter(value>=0.4)
    Var1 Var2 value signo
1    X40  X41  0.80     +
2    X42  X43  0.80     +
3    X11  X12  0.79     +
4    X13  X14  0.79     +
5    X22  X23  0.79     +
6    X25  X26  0.79     +
7     X6   X7  0.78     +
8     X7   X8  0.78     +
9    X12  X13  0.78     +
10   X43  X44  0.78     +
11    X4   X5  0.77     +
12   X26  X27  0.77     +
13   X49  X50  0.77     +
14    X5   X6  0.76     +
15    X9  X10  0.76     +
16   X18  X19  0.76     +
17   X23  X24  0.76     +
18   X44  X45  0.76     +
19   X10  X11  0.75     +
20   X21  X22  0.75     +
21   X24  X25  0.75     +
22   X29  X30  0.75     +
23   X33  X34  0.75     +
24   X35  X36  0.75     +
25    X8   X9  0.74     +
26   X15  X16  0.74     +
27   X16  X17  0.74     +
28   X17  X18  0.74     +
29   X19  X20  0.74     +
30   X20  X21  0.74     +
31   X28  X29  0.74     +
32   X30  X31  0.74     +
33   X31  X32  0.74     +
34   X32  X33  0.74     +
35   X34  X35  0.74     +
36   X36  X37  0.74     +
37   X39  X40  0.74     +
38    X3   X4  0.73     +
39   X14  X15  0.73     +
40   X27  X28  0.73     +
41   X38  X39  0.73     +
42    X2   X3  0.72     +
43   X37  X38  0.72     +
44   X41  X42  0.72     +
45   X45  X46  0.72     +
46    X1   X2  0.71     +
47   X48  X49  0.71     +
48    X6   X8  0.69     +
49   X22  X24  0.65     +
50   X46  X47  0.65     +
51   X11  X13  0.64     +
52   X32  X34  0.64     +
53   X47  X48  0.64     +
54   X41  X43  0.62     +
55   X10  X12  0.61     +
56   X12  X14  0.61     +
57   X42  X44  0.61     +
58   X43  X45  0.61     +
59    X8  X10  0.60     +
60   X24  X26  0.60     +
61    X4   X6  0.59     +
62    X9  X11  0.59     +
63   X14  X16  0.59     +
64   X21  X23  0.59     +
65   X39  X41  0.59     +
66    X7   X9  0.58     +
67   X40  X42  0.58     +
68    X5   X7  0.57     +
69   X13  X15  0.57     +
70   X15  X17  0.57     +
71   X17  X19  0.57     +
72   X25  X27  0.57     +
73   X26  X28  0.57     +
74   X35  X37  0.57     +
75    X2   X4  0.56     +
76    X3   X5  0.56     +
77   X18  X20  0.56     +
78   X19  X21  0.56     +
79   X33  X35  0.56     +
80   X44  X46  0.56     +
81    X1   X3  0.55     +
82   X23  X25  0.55     +
83   X28  X30  0.55     +
84   X30  X32  0.55     +
85   X34  X36  0.55     +
86    X5   X8  0.53     +
87   X20  X22  0.53     +
88   X31  X33  0.52     +
89   X48  X50  0.52     +
90    X6   X9  0.51     +
91   X12  X15  0.51     +
92   X36  X38  0.51     +
93   X37  X39  0.51     +
94   X38  X40  0.51     +
95   X10  X13  0.50     +
96   X27  X29  0.50     +
97   X29  X31  0.50     +
98   X32  X35  0.50     +
99   X41  X44  0.50     +
100  X13  X16  0.49     +
101  X43  X46  0.49     +
102   X7  X10  0.48     +
103  X11  X14  0.48     +
104  X16  X18  0.48     +
105  X21  X24  0.48     +
106  X22  X25  0.48     +
107  X39  X42  0.48     +
108  X40  X43  0.48     +
109   X8  X11  0.47     +
110  X46  X48  0.47     +
111   X4   X7  0.46     +
112   X9  X12  0.46     +
113  X42  X45  0.46     +
114  X14  X17  0.45     +
115  X18  X21  0.45     +
116  X31  X34  0.45     +
117  X35  X38  0.45     +
118  X45  X47  0.45     +
119   X1   X4  0.44     +
120   X2   X5  0.44     +
121  X23  X26  0.44     +
122  X39  X43  0.44     +
123  X20  X23  0.43     +
124  X24  X27  0.43     +
125  X25  X28  0.43     +
126  X30  X33  0.43     +
127  X38  X41  0.43     +
128   X3   X6  0.42     +
129   X5   X9  0.42     +
130   X6  X10  0.42     +
131   X4   X8  0.41     +
132  X19  X22  0.41     +
133  X34  X38  0.41     +
134  X41  X45  0.41     +
135  X47  X49  0.41     +
136  X15  X18  0.40     +
137  X36  X39  0.40     +

> pip
    PIP1  PIP2 PIP3 PIP4 PIP5 conteo
X1   0.0  12.7  2.1  1.9  0.0      0
X2   0.0   2.8  1.5  0.0  0.0      0
X3   0.0   0.0  5.1  0.0  0.0      0
X4   0.0   0.0  0.0  0.0  0.0      0
X5   0.0   0.0  0.0  0.0  0.0      0
X6  86.2 100.0 90.1 98.9 87.7      5
X7  86.2 100.0 86.7 98.9 87.7      5
X8   0.8   4.3  7.5  0.0  0.0      0
X9   0.0   0.0  0.0  0.0  0.0      0
X10 10.7   6.4  1.1  2.0  0.0      0
X11 54.7  79.6 93.7 73.4 66.4      5
X12  0.0   0.0  0.0  2.5  1.2      0
X13  0.0   0.0  0.0  2.9  2.1      0
X14  0.0   0.5  0.0  9.9  0.0      0
X15 80.8  98.7 16.1 81.5 39.7      3
X16  9.6   0.8 70.5  6.6 43.4      1
X17  1.0   0.0  0.0  0.0  6.9      0
X18 23.5   0.0  0.0  0.0 12.7      0
X19  0.0   0.0  0.0  0.0  0.0      0
X20  8.6   6.0  0.0  0.0 28.3      0
X21  7.9   0.0  0.0  0.0  0.0      0
X22  3.2   0.0  0.0  0.0  0.0      0
X23 21.3   0.0  1.6  0.0  0.0      0
X24  0.0   0.0  0.0  0.0  0.0      0
X25  1.8   0.0  3.6  0.0  0.0      0
X26  0.0   0.0  0.0  0.0  0.0      0
X27  7.0   0.0  0.0  0.0  0.0      0
X28  0.0   0.0  0.0  2.1  0.0      0
X29  0.0   0.0  0.0  0.0  0.0      0
X30  0.0   0.0  0.0  0.0  7.8      0
X31  0.0   0.0  0.0  0.0  0.0      0
X32  0.0   0.0  0.0  1.9  0.8      0
X33  0.0   0.0  0.0  2.0  1.5      0
X34  0.0   0.0  0.0  0.0  0.0      0
X35  0.0   0.0  0.0  0.0  0.0      0
X36  0.0   0.0  0.0  0.0  0.0      0
X37  0.0   0.0  0.0  0.0  0.0      0
X38  0.0  18.7  0.6  0.0  0.0      0
X39  0.0   3.5  6.6  0.0  0.0      0
X40  0.0  21.0  1.9  0.0  0.0      0
X41  0.0   0.0  0.0  0.0  0.0      0
X42  0.0   1.4  0.0  0.0  0.0      0
X43  2.8   1.4  0.0  1.8  0.0      0
X44  0.0   0.0  0.0  0.0  0.0      0
X45  0.9  23.5  6.0  3.6  0.0      0
X46  0.8  26.8 31.9  9.6  3.1      0
X47  0.9   0.6 30.4 19.2 93.8      1
X48 88.3  17.6 10.6 13.6  3.1      1
X49  6.3  44.1  5.6 68.2  5.8      1
X50  0.0  12.7  2.9  2.3 12.2      0

> 
> # variables seleccionadas pip mayor a 50
> 
> seleccion<-c(6,7,10,11,15,16,18,49)
> 
> head(cormat)
    X6   X7  X10  X11  X15  X16  X18   X49
X6  NA 0.78 0.42 0.36 0.16 0.18 0.18 -0.03
X7  NA   NA 0.48 0.35 0.16 0.17 0.14  0.00
X10 NA   NA   NA 0.75 0.27 0.21 0.18  0.04
X11 NA   NA   NA   NA 0.36 0.23 0.19  0.02
X15 NA   NA   NA   NA   NA 0.74 0.40 -0.06
X16 NA   NA   NA   NA   NA   NA 0.48  0.03
> melted_cormat <- melt(cormat)
> melted_cormat <- melted_cormat %>% drop_na()
> melted_cormat %>% filter(value>=0.4)
  Var1 Var2 value signo
1   X6   X7  0.78     +
2  X10  X11  0.75     +
3  X15  X16  0.74     +
4   X7  X10  0.48     +
5  X16  X18  0.48     +
6   X6  X10  0.42     +
7  X15  X18  0.40     +
> 
> y.all <- df[,2]
> x.all <- scale(df[,seleccion+2])
> 
> bicbma.model.pre<-bic.glm(x.all, y.all, glm.family = gaussian(link = "identity"),maxCol=51,
+                           strict = FALSE, OR = 20, OR.fix = 2, nbest = 10, occam.window = TRUE)
> 
> summary(bicbma.model.pre)

Call:
bic.glm.matrix(x = x.all, y = y.all, glm.family = gaussian(link = "identity"),     strict = FALSE, OR = 20, maxCol = 51, OR.fix = 2, nbest = 10,     occam.window = TRUE)


  10  models were selected
 Best  5  models (cumulative posterior probability =  0.7813 ): 

           p!=0    EV       SD      model 1    model 2    model 3    model 4    model 5  
Intercept  100     2.62268  0.2033     2.6227     2.6227     2.6227     2.6227     2.6227
X6         100.0   1.20699  0.3332     1.2254     1.1700     1.2147     1.3604     1.1795
X7         100.0  -1.35481  0.3334    -1.3857    -1.3892    -1.2507    -1.2816    -1.3714
X10         15.7  -0.08525  0.2363      .          .        -0.5226      .          .    
X11         93.1   0.74294  0.3455     0.6859     0.8322     1.0322      .         0.6808
X15         69.2   0.58141  0.4424     0.8577      .         0.8551     1.0644     0.7462
X16         36.7   0.26424  0.3846      .         0.7863      .          .          .    
X18          8.6   0.02443  0.1040      .          .          .          .         0.2958
X49         92.4   0.58818  0.2613     0.6551     0.5803     0.6715     0.6848     0.6475
                                                                                         
nVar                                     5          5          6          4          6   
BIC                                 -831.3839  -829.9175  -828.6611  -827.9960  -827.8217
post prob                              0.374      0.180      0.096      0.069      0.063 
> 
> cv.ridge.pre <- cv.glmnet(x.all, y.all, family = "gaussian", nfold = 5, type.measure = "mse", parallel = TRUE, alpha = 0,standardize = FALSE)
> ridge.model.pre <- glmnet(x.all, y.all, family = "gaussian", lambda = cv.ridge.pre$lambda.min, alpha = 0,standardize = FALSE)
> 
> coef(ridge.model.pre)
9 x 1 sparse Matrix of class "dgCMatrix"
                    s0
(Intercept)  2.6226774
X6           0.8669292
X7          -0.9515885
X10         -0.4120236
X11          0.9103677
X15          0.4940840
X16          0.3282149
X18          0.2493334
X49          0.5875031
> 
> #  variables definitivas luego de ridge ------------------------------------------
> 
> seleccion<-c(6,7,11,15,49)
> 
> # lasso test
> 
> colMeans(mse.test.total.lasso)
  [1] 8.580799 8.583157 8.512488 8.567249 8.850860 8.616402 8.555178 8.945895 8.650656 8.595047
 [11] 8.615505 8.583687 8.674481 8.727574 8.749077 8.579596 9.050230 8.742676 8.434267 8.477343
 [21] 8.896181 8.475406 8.775607 8.397281 8.653137 8.836664 8.451474 8.889759 8.793400 8.524423
 [31] 8.876086 8.446119 8.695186 8.638642 8.605313 8.772919 8.444683 8.870506 8.486560 8.648136
 [41] 8.731014 8.613003 8.738191 8.767659 8.528662 8.722872 8.529948 8.883101 8.669657 8.696144
 [51] 8.679508 8.855716 8.569641 8.805517 8.584251 8.909976 8.642461 8.734848 8.535910 8.732982
 [61] 8.635931 8.704117 8.941990 8.337019 8.581708 8.942717 8.812755 9.338340 8.911460 8.686757
 [71] 8.549876 8.694192 8.504446 8.860586 8.672845 8.569802 8.817052 8.680476 8.634526 8.753171
 [81] 8.795099 8.811503 9.123525 8.468853 8.501812 8.626861 8.651298 8.961524 8.602407 8.966563
 [91] 8.829587 8.614980 8.717672 9.034140 8.751891 8.697868 8.493107 8.618602 8.716921 8.685482
> 
> mean(colMeans(mse.test.total.lasso))
[1] 8.695002
> 
> sd(colMeans(mse.test.total.lasso))
[1] 0.1692042
> 
> # ridge test
> colMeans(mse.test.total.ridge)
  [1] 8.703803 8.583620 8.593600 8.465283 8.853938 8.570766 8.877079 8.622200 8.778989 8.910070
 [11] 8.509717 8.410498 8.893365 8.673469 8.545722 8.852131 8.697066 8.597150 8.714842 8.768501
 [21] 8.764040 9.099760 8.790456 8.917386 8.793691 8.800179 8.760764 8.879557 8.843206 8.760940
 [31] 8.468165 8.510373 8.622009 8.767031 8.598738 8.612407 8.715097 8.792980 8.820755 8.669318
 [41] 8.942831 8.734182 8.511374 8.392036 8.787522 9.001387 8.545249 8.729025 8.972711 8.666080
 [51] 8.566333 8.655746 8.605429 8.989803 8.566350 8.748761 8.689506 8.648727 8.520819 8.495578
 [61] 8.660908 8.640020 8.857513 8.930497 8.783073 8.689113 8.539393 8.785934 8.693927 8.743553
 [71] 8.639880 8.750503 8.619966 8.620985 8.464168 8.649769 8.653410 8.652635 8.666169 8.508432
 [81] 8.681584 8.615392 8.705648 8.604502 9.106105 8.557180 8.578008 8.714056 8.689534 8.918987
 [91] 8.682221 8.649729 8.628330 8.777502 8.748673 8.537142 8.694113 8.591940 8.567801 8.680386
> 
> mean(colMeans(mse.test.total.ridge))
[1] 8.696568
> 
> sd(colMeans(mse.test.total.ridge))
[1] 0.1438789
> 
> # elasticnet test
> colMeans(mse.test.total.elasticnet)
  [1] 8.854240 8.615063 8.754981 8.753501 9.092197 9.092241 8.797210 8.954269 8.755920 8.635674
 [11] 8.602385 8.945712 8.894970 8.743172 8.711999 8.603078 9.149605 8.796596 8.805614 8.677769
 [21] 8.759095 8.639911 8.560190 8.535083 8.863607 8.489308 8.557408 8.600183 8.540119 8.952670
 [31] 8.816710 8.394675 8.826959 8.671775 8.626985 8.773421 8.704505 8.793157 8.491192 8.781249
 [41] 8.681483 8.979013 8.618833 8.714791 8.679637 8.810107 8.567737 8.875097 8.703959 9.172629
 [51] 8.579184 8.746773 8.455125 8.557345 8.760660 8.804207 8.723544 8.755538 8.910036 8.860825
 [61] 8.549799 8.715421 8.591075 8.590190 8.806564 8.767235 8.628679 8.771094 8.531552 8.790955
 [71] 8.712555 9.061787 8.617881 9.006739 8.627161 8.714180 8.692329 8.908276 8.632177 8.748423
 [81] 8.725403 8.577995 8.607820 8.531581 8.764192 8.713965 8.687258 8.896529 8.817699 8.632054
 [91] 8.881274 8.764305 8.981797 8.980186 8.604851 8.844448 8.715306 8.461109 8.532351 8.695605
> 
> mean(colMeans(mse.test.total.elasticnet))
[1] 8.734507
> 
> sd(colMeans(mse.test.total.elasticnet))
[1] 0.1577332
> 
> # BMA bic - GLM - test
> colMeans(mse.test.total.bicbma2)
  [1] 8.669456 8.435956 8.893021 8.739966 8.779729 8.843599 8.579369 8.531662 8.995747 8.819545
 [11] 9.201135 8.871844 8.556443 8.591726 8.842702 8.520788 8.580720 8.725095 9.036555 8.667540
 [21] 8.682405 9.101635 8.603310 8.651050 8.701972 8.783576 8.657209 8.672299 8.805372 8.854645
 [31] 8.574572 9.063221 8.853873 8.430600 8.597912 8.697683 8.849306 8.751746 8.712278 8.579821
 [41] 8.639739 9.058784 8.700772 8.605944 8.960614 8.567843 9.101151 8.876133 8.644022 8.774330
 [51] 8.692004 8.566974 8.723612 8.591064 8.817441 8.733403 8.956073 8.876457 8.898703 8.809538
 [61] 8.547684 8.983505 8.672674 8.587729 8.558965 9.048332 8.790096 9.239030 8.473126 8.867914
 [71] 8.677350 8.491415 8.695868 8.717701 8.570211 8.833804 8.618879 8.537814 8.790457 8.626779
 [81] 8.952435 8.765092 8.613495 8.658672 8.761549 8.922287 8.984246 8.687194 8.701514 8.704551
 [91] 8.646613 8.681556 8.718945 9.012499 8.636096 8.698105 8.656191 8.497610 9.321903 8.557968
> 
> mean(colMeans(mse.test.total.bicbma2))
[1] 8.746095
> 
> sd(colMeans(mse.test.total.bicbma2))
[1] 0.1804632
> 
> # resultados tabla final
> tablafinal

              intercept          X6         X7        X11         X15        X49
Lasso          2.622677   1.2089411  -1.367938  0.6830995   0.8547598  0.6509880
Ridge          2.622677   0.9721221  -1.111089  0.6595083   0.8171539  0.6130115
Elasticnet     2.622677   1.2093889  -1.368499  0.6833966   0.8549674  0.6513599
BMA_post       2.622677   1.2425900  -1.368068  0.5846522   0.8856758  0.6139616
BMA_condpost   2.622677   1.2425900  -1.368068  0.6888729   0.8856758  0.6599246
PIP_BMA      100.000000 100.0000000 100.000000 84.9000000 100.0000000 93.0000000
> 
> summary(bicbma.model2)

Call:
bic.glm.matrix(x = x.all, y = y.all, glm.family = gaussian(link = "identity"),     strict = FALSE, OR = 20, maxCol = 51, OR.fix = 2, nbest = 10,     occam.window = TRUE)


  3  models were selected
 Best  3  models (cumulative posterior probability =  1 ): 

           p!=0    EV      SD      model 1    model 2    model 3  
Intercept  100     2.6227  0.2046     2.6227     2.6227     2.6227
X6         100.0   1.2426  0.3346     1.2254     1.3604     1.1793
X7         100.0  -1.3681  0.3313    -1.3857    -1.2816    -1.3583
X11         84.9   0.5847  0.3280     0.6859      .         0.7226
X15        100.0   0.8857  0.2314     0.8577     1.0644     0.8101
X49         93.0   0.6140  0.2603     0.6551     0.6848      .    
                                                                  
nVar                                    5          4          4   
BIC                                -833.8736  -830.5958  -829.0443
post prob                             0.779      0.151      0.070 

> tablafinal
      Model_all   CV1   CV2   CV3   CV4   CV5 meanCV sdCV
MSEL       8.12 10.04  8.26  8.24 10.36  6.51   8.69 1.56
MSER       8.16  7.97  7.03  7.82  8.53 12.06   8.68 1.96
MSEE       8.12  5.86 10.81 11.60  5.98  9.23   8.70 2.67
MSEB       8.13  9.29  6.81  5.27 13.28 10.52   9.04 3.14
MSEB2      8.12  8.89  6.31  4.55 13.20  9.85   8.56 3.33